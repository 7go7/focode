<!DOCTYPE html>
<html>

<head>
  <title>Editor - FOCODE CMS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    #editor {
      height: 500px;
      background: white;
      font-size: 16px;
    }

    body {
      background-color: #f8f9fa;
      padding-bottom: 50px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark px-4 mb-4">
    <a class="navbar-brand" href="/admin/dashboard">FOCODE ADMIN</a>
    <a href="/admin/dashboard" class="btn btn-outline-light btn-sm">Back to Dashboard</a>
  </nav>

  <div class="container">
    <h2 class="mb-4 fw-bold border-bottom pb-2"><%= article ? 'Edit Article' : 'Create New Article' %></h2>

    <form method="POST" action="<%= article ? '/admin/update/' + article.id : '/admin/save' %>" enctype="multipart/form-data">

      <div class="row">
        <div class="col-md-8">
          <div class="mb-3">
            <label class="form-label fw-bold">Title</label>
            <input type="text" name="title" class="form-control form-control-lg" value="<%= article ? article.title : '' %>" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Short Summary</label>
            <textarea name="summary" class="form-control" rows="2" placeholder="Brief description for the homepage card..."><%= article ? article.summary : '' %></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Content</label>
            <div id="editor"><%- article ? article.html : '' %></div>
            <input type="hidden" name="html" id="htmlInput">
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Content</label>
            <div id="editor"><%- article ? article.html : '' %></div>
            <input type="hidden" name="html" id="htmlInput">
          </div>
        </div>

        <div class="col-md-4">
          <div class="card p-3 shadow-sm border-0">
            <h5 class="card-title fw-bold mb-3 text-secondary">Settings</h5>

            <div class="mb-3">
              <label class="form-label fw-bold small">CATEGORY</label>
              <select name="category" class="form-select">
                <option value="NEWS" <%= article?.category=='NEWS'?'selected':'' %>>News Article</option>
                <option value="REPORT" <%= article?.category=='REPORT'?'selected':'' %>>Official Report</option>
                <option value="STATEMENT" <%= article?.category=='STATEMENT'?'selected':'' %>>Press Statement</option>
                <option value="ANALYSIS" <%= article?.category=='ANALYSIS'?'selected':'' %>>Analysis</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold small">COVER IMAGE</label>

              <ul class="nav nav-tabs mb-2 small" id="imgTab" role="tablist">
                <li class="nav-item">
                  <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button">Upload</button>
                </li>
                <li class="nav-item">
                  <button class="nav-link" id="url-tab" data-bs-toggle="tab" data-bs-target="#url" type="button">URL</button>
                </li>
              </ul>

              <div class="tab-content">
                <div class="tab-pane fade show active" id="upload">
                  <input type="file" name="image" class="form-control form-control-sm">
                </div>
                <div class="tab-pane fade" id="url">
                  <input type="text" name="imageUrl" class="form-control form-control-sm" placeholder="https://...">
                </div>
              </div>

              <% if(article && article.image) { %>
              <input type="hidden" name="existingImage" value="<%= article.image %>">
              <div class="mt-3">
                <small class="text-muted d-block">Current:</small>
                <img src="<%= article.image %>" class="img-fluid rounded border">
              </div>
              <% } %>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold small">DISPLAY DATE</label>
              <input type="text" name="date" class="form-control" value="<%= article ? article.date : new Date().toDateString() %>">
            </div>

            <div class="form-check form-switch mb-4">
              <input class="form-check-input" type="checkbox" name="published" value="true" <%= (!article || article.published) ? 'checked' : '' %>>
              <label class="form-check-label fw-bold">Publish Immediately</label>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary fw-bold">SAVE CHANGES</button>
              <a href="/admin/dashboard" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    var quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{
            'header': [1, 2, 3, false]
          }],
          ['bold', 'italic', 'underline', 'strike', 'blockquote'],
          [{
            'list': 'ordered'
          }, {
            'list': 'bullet'
          }],
          [{
            'align': []
          }],
          ['link', 'image', 'video'], // Added video support
          ['clean']
        ]
      }
    });

    // Sync HTML to hidden input on submit
    document.querySelector('form').onsubmit = function() {
      var html = quill.root.innerHTML;
      document.querySelector('#htmlInput').value = html;
    };
  </script>
</body>

</html>